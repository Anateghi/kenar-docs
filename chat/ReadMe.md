# 💬 افزونه‌های چت دیوار

## نمایش شما به عنوان خدمت‌دهنده به کاربران

در چت دیوار به طرفین چت بر اساس مواردی مثل شهر یا دسته‌ٔ آگهی خدماتی را پیشنهاد می‌دهیم که اگر برنامهٔ شما در آن گروه برنامه‌ها باشد به عنوان خدمت‌دهنده به کاربران معرفی می‌شود.
مثلاً شما می‌توانید به عنوان خدمت‌دهنده در افزونه‌های ارسال کالا در چت به کاربران معرفی شوید تا با بازکردن برنامهٔ وب شما، درخواست خود را ثبت کنند.

|              ![مسیر ارائهٔ خدمات در چت](/img/chat-flow.png)               |
| :-----------------------------------------------------------------------: |
| <sub dir="rtl">مسیری که کاربر برای دریافت خدمات شما در چت طی می کند</sub> |

## بازشدن برنامه توسط کاربر

۱. در هر زمانی که چت دیوار بخواهد برنامهٔ شما را باز کند، درخواستی با جزییات زیر به آدرسی که در فیلد ‍`Session Initialization URL` [در پنل کنار وارد کرده‌اید](/management/#لیست-پارامترها) ارسال می‌کند و در صورت دریافت پاسخ معتبر، کاربر را به آدرسی که در پاسخ وجود دارد هدایت می‌کند.

```http request
POST {{YOUR_INIT_URL}}
Content-Type: application/json
Authorization: {{YOUR_DIVAR_AUTH_HEADER}}
API_VERSION: 2

{
  "return_url": "https://divar.ir/"
  "source": "CHAT_MESSAGE_ACTION",
  "post_token": "wZC44q5D",
  "conversation_id": "6b3d5cf7-9291-4fa9-892a-9d07e300daea",
  "user_side": "Supply",
  "extra_data": {
    "your_key_1": "your value",
    "your_key_2": "your value"
  }
}
```

آدرسی که درخواست به آن زده می‌شود را می‌توانید در پنل کنار دیوار، با عنوان `لینک درخواست دیوار برای گرفتن آدرس شروع` تنظیم کنید.



| نام فیلد        |        نوع        | حداکثر طول |                                                          توضیحات |
|:----------------|:-----------------:|:----------:|-----------------------------------------------------------------:|
| return_url      |      String       |    2048    |              آدرسی که کاربر پس از اتمام فراید باید به آن بازگردد |
| source          |      String       |     20     |              محلی که کاربر از آن به سمت برنامه شما هدایت شده است |
| post_token      | String (Nullable) |     10     |                                          توکن پست (در صورت وجود) |
| conversation_id | String (Nullable) |     64     |                                 شناسه مرتبط با چت (در صورت وجود) |
| user_side       | String (Nullable) |     50     |                                    نوع کاربر (خریدار یا فروشنده) |
| extra_data      |       JSON        |    N/A     | داده‌های اضافی که از سمت برنامه‌ی شما در کلید data قرار داده شده |


انتظار می‌رود که در پاسخ به این درخواست، پاسخ موفق با کد وضعیت ۲۰۰ برگردانده شود
و بدنه‌ی پاسخ به صورت زیر باشد:
```json
{
  "url": "https://your-domain.com/landings/6b3d5cf7-9291-4fa9-892a-9d07e300daea"
}
```


<br>

## ارائهٔ خدمات در برنامهٔ تحت وب شما و بازگشت به دیوار

پس از باز شدن برنامهٔ شما در اپ دیوار به صورت webview در اپلیکیشن‌های دیوار یا pop-up در وب دیوار، کاربر عملیات مورد نظر شما را در برنامهٔ شما طی می‌کند و خدمات مورد نظر را دریافت می‌کند. پس از اتمام کار برنامه می‌بایست کاربر را به دیوار برگرداند.\
پیشنهاد می‌کنیم در زمان‌هایی که دانستن نتیجهٔ کار برای هر دو طرف چت لازم است، [نتیجه را در چت اعلام کنید][چت»ارسال پیام] و دکمه‌ای برای پیگیری نیز در پیام درج کنید.

برای ارسال پیام در چت باید در برنامهٔ خود از طریق [احراز باز](/oauth/) اجازهٔ ارسال پیام در چت را از کاربر گرفته‌باشید. \
همچنین ممکن است نیاز به دریافت دسترسی برای ارسال پیام در چت یا موارد دیگر از کاربر شوید که می‌توانید با استفاده از [احراز باز](/oauth/) در موردشان از کاربر اجازه بگیرید.


## خواندن و ارسال پیام در تمام مکالمات مربوط به یک آگهی (آزمایشی)

برای خواندن پیام‌های چت به صورت لحظه‌ای می‌توانید از مستندات [مطلع شدن از رویداد‌های جدید](/events/ReadMe.md) استفاده کنید.

 همچنین برای ارسال پیام می‌توانید به مستندات [ارسال پیام در چت][چت»ارسال پیام] مراجعه کنید.


## مکالمه با کاربر به شکل چت‌بات (آزمایشی)

به منظور ایجاد و فعال‌سازی چت‌بات می‌توانید به پشتیبانی کنار دیوار تیکت بزنید و درخواست خود را مطرح کنید تا زیرساخت آن در دسترس شما قرار بگیرد.

در صورت برخوردار شدن از این امکان توسط پشتیبانی، با پر کردن مقدار `آدرس ارسال رویدادها` در پنل کنار، پیام‌های ارسالی به چت‌بات خود را دریافت خواهید کرد. برای اطلاعات بیشتر و فرمت درخواست‌های ارسالی می‌توانید [اینجا][راهنما » چت‌بات » دریافت‌پیام‌ها] را مطالعه کنید.

همچنین می‌توانید به کاربرانی که به چت‌بات شما پیام داده‌اند، پیام بفرستید. برای اطلاعات بیشتر [اینجا][راهنما » چت‌بات » ارسال‌پیام] را مطالعه کنید.
<br>
مثال چت: پیاده‌سازی
[بازی ایکس او](https://github.com/amirsalarsafaei/kenar-xo/tree/master)
با کنار دیوار


## دسترسی سریع

- [🔑 دریافت دسترسی‌ها از کاربر](/oauth/)
- [↗️ ارسال پیام در چت][چت»ارسال پیام]

[آگهی]: /management/#تعامل-با-کاربر-پس-از-ثبت-آگهی
[راهنما » احراز باز]: /oauth
[امکانات چت]: /chat/#دسترسی-سریع
[راهنما » چت‌بات » دریافت‌پیام‌ها]: /chat/chatbot_conversations.md
[چت»ارسال پیام]: /chat/send_message.md

<br><br>

<div align="center">

<img src="../img/wire-puzzle.svg" height="156px"/>

</div>

<br><br>
